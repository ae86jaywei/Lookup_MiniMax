name: ä¸­æœ›CADåŠ¨æ€å—æŸ¥å¯»æ’ä»¶ - æµ‹è¯• æ„å»º

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 2 * * *'

env:
  DOTNET_VERSION: '6.0.x'
  DOTNET_FRAMEWORK_VERSION: 'net48'
  PROJECT_NAME: 'ZWDynLookup'
  SOLUTION_NAME: 'ZWDynLookup.sln'
  TEST_PROJECT_NAME: 'ZWDynLookup.Tests'
  COVERAGE_THRESHOLD: 85

permissions:
  contents: read
  checks: write
  security-events: write

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥ - ç®€åŒ–ç‰ˆæœ¬ï¼ˆç§»é™¤æœ‰é—®é¢˜çš„MSBuildå®‰è£…ï¼‰
  code-quality:
    name: ä»£ç è´¨é‡æ£€æŸ¥
    runs-on: windows-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: è®¾ç½® .NET Framework
      uses: microsoft/setup-msbuild@v1.3  # æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
      with:
        msbuild-version: 'latest'

    - name: è®¾ç½® .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: è¿˜åŸNuGetåŒ…
      shell: pwsh
      run: |
        dotnet restore ${{ env.SOLUTION_NAME }}
        dotnet restore ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj

    - name: æ£€æŸ¥SonarCloudé…ç½®
      shell: pwsh
      run: |
        Write-Host "æ£€æŸ¥SonarCloudé…ç½®..."
        if (-not $env:SONAR_TOKEN) {
          Write-Host "è­¦å‘Š: SONAR_TOKENæœªè®¾ç½®ï¼Œè·³è¿‡SonarCloudåˆ†æ" -ForegroundColor Yellow
          echo "SONARCLOUD_SKIP=true" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        } else {
          Write-Host "SONAR_TOKENå·²é…ç½®ï¼Œç»§ç»­æ‰§è¡ŒSonarCloudåˆ†æ" -ForegroundColor Green
          echo "SONARCLOUD_SKIP=false" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        }

    - name: å®‰è£…SonarScanner
      if: env.SONARCLOUD_SKIP == 'false'
      run: dotnet tool install --global dotnet-sonarscanner

    - name: æ„å»ºé¡¹ç›®ï¼ˆç”¨äºä»£ç æ£€æŸ¥ï¼‰
      shell: pwsh
      run: |
        Write-Host "æ„å»ºé¡¹ç›®..." -ForegroundColor Green
        
        # ä½¿ç”¨ setup-msbuild æä¾›çš„ msbuild
        msbuild ${{ env.SOLUTION_NAME }} /p:Configuration=Release /p:Platform="Any CPU" /v:minimal
        
        if (Test-Path "bin\Release\net48\ZWDynLookup.dll") {
          Write-Host "ä¸»é¡¹ç›®æ„å»ºæˆåŠŸ" -ForegroundColor Green
        } else {
          Write-Host "ä¸»é¡¹ç›®æ„å»ºå¤±è´¥" -ForegroundColor Red
          exit 1
        }

    - name: è¿è¡Œæµ‹è¯•ï¼ˆç”¨äºä»£ç æ£€æŸ¥ï¼‰
      shell: pwsh
      run: |
        Write-Host "è¿è¡Œæµ‹è¯•..." -ForegroundColor Green
        
        dotnet test ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj `
          --configuration Release `
          --no-build `
          --verbosity normal `
          --logger "console;verbosity=normal"

    - name: SonarCloudåˆ†æï¼ˆå¦‚æœé…ç½®ï¼‰
      if: env.SONARCLOUD_SKIP == 'false'
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      shell: pwsh
      run: |
        Write-Host "å¼€å§‹SonarCloudåˆ†æ..." -ForegroundColor Green
        if (-not $env:SONAR_TOKEN) {
          Write-Host "é”™è¯¯: SONAR_TOKENä¸ºç©º" -ForegroundColor Red
          exit 1
        }
        
        Write-Host "å¼€å§‹SonarScanner..." -ForegroundColor Cyan
        dotnet sonarscanner begin `
          /k:"${{ env.PROJECT_NAME }}" `
          /o:"ae86jaywei" `
          /d:sonar.token="${{ env.SONAR_TOKEN }}" `
          /d:sonar.host.url="https://sonarcloud.io" `
          /d:sonar.cs.vstest.reportsPaths="**/*.trx" `
          /d:sonar.coverage.exclusions="**/*Test*/**,**/Tests/**"

        Write-Host "æ„å»ºç”¨äºSonarCloud..." -ForegroundColor Cyan
        msbuild ${{ env.SOLUTION_NAME }} /p:Configuration=Release /p:Platform="Any CPU" /v:minimal
        
        Write-Host "è¿è¡Œæµ‹è¯•ç”¨äºSonarCloud..." -ForegroundColor Cyan
        dotnet test ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj `
          --configuration Release `
          --no-build `
          --verbosity minimal `
          --collect:"XPlat Code Coverage"

        Write-Host "ç»“æŸSonarScanner..." -ForegroundColor Cyan
        dotnet sonarscanner end /d:sonar.token="${{ env.SONAR_TOKEN }}"

    - name: åŸºæœ¬ä»£ç è´¨é‡æŠ¥å‘Š
      shell: pwsh
      run: |
        Write-Host "=== ä»£ç è´¨é‡æ£€æŸ¥æŠ¥å‘Š ===" -ForegroundColor Cyan
        Write-Host "1. æ„å»º: âœ… æˆåŠŸ" -ForegroundColor Green
        Write-Host "2. æµ‹è¯•: âœ… è¿è¡Œå®Œæˆ" -ForegroundColor Green
        
        if ($env:SONARCLOUD_SKIP -eq 'true') {
          Write-Host "3. SonarCloud: âš ï¸ æœªé…ç½® (è¯·åœ¨GitHub Secretsä¸­æ·»åŠ SONAR_TOKEN)" -ForegroundColor Yellow
        } else {
          Write-Host "3. SonarCloud: âœ… åˆ†æå®Œæˆ" -ForegroundColor Green
        }

  # Windowsç¯å¢ƒæµ‹è¯•
  test-windows:
    name: Windowsç¯å¢ƒæµ‹è¯•
    runs-on: windows-latest
    needs: code-quality
    
    strategy:
      matrix:
        configuration: [Debug, Release]
        framework: [net48]
        
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½® .NET Framework
      uses: microsoft/setup-msbuild@v1.3
      with:
        msbuild-version: 'latest'

    - name: è®¾ç½® .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: è¿˜åŸNuGetåŒ…
      shell: pwsh
      run: |
        dotnet restore ${{ env.SOLUTION_NAME }}
        dotnet restore ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj

    - name: ç¼“å­˜NuGetåŒ…
      uses: actions/cache@v3
      with:
        path: ~/.nuget/packages
        key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
        restore-keys: |
          ${{ runner.os }}-nuget-

    - name: æ„å»ºé¡¹ç›® (${{ matrix.configuration }})
      shell: pwsh
      run: |
        Write-Host "æ„å»ºé¡¹ç›® - ${{ matrix.configuration }} æ¨¡å¼" -ForegroundColor Green
        
        # æ¸…ç†æ„å»ºç›®å½•
        if (Test-Path "bin") {
          Remove-Item -Path "bin" -Recurse -Force -ErrorAction SilentlyContinue
        }
        
        msbuild ${{ env.SOLUTION_NAME }} /p:Configuration=${{ matrix.configuration }} /p:Platform="Any CPU" /v:minimal
        
        if (Test-Path "bin\${{ matrix.configuration }}\net48\ZWDynLookup.dll") {
          Write-Host "ä¸»é¡¹ç›®æ„å»ºæˆåŠŸ" -ForegroundColor Green
          Write-Host "æ„å»ºè¾“å‡º: bin\${{ matrix.configuration }}\net48\" -ForegroundColor Cyan
        } else {
          Write-Host "ä¸»é¡¹ç›®æ„å»ºå¤±è´¥" -ForegroundColor Red
          exit 1
        }

    - name: è¿è¡Œå•å…ƒæµ‹è¯•
      shell: pwsh
      run: |
        Write-Host "å¼€å§‹å•å…ƒæµ‹è¯•..." -ForegroundColor Green
        
        New-Item -ItemType Directory -Path "TestResults" -Force
        
        dotnet test ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj `
          --configuration ${{ matrix.configuration }} `
          --framework ${{ env.DOTNET_FRAMEWORK_VERSION }} `
          --no-build `
          --verbosity normal `
          --logger "trx;LogFileName=test-results.trx" `
          --results-directory TestResults `
          --collect:"XPlat Code Coverage"

    - name: ä»£ç è¦†ç›–ç‡åˆ†æ
      shell: pwsh
      run: |
        Write-Host "åˆ†æä»£ç è¦†ç›–ç‡..." -ForegroundColor Green
        
        $coverageFiles = Get-ChildItem -Path "TestResults" -Filter "*.cobertura.xml" -Recurse
        if ($coverageFiles) {
          Write-Host "æ‰¾åˆ°è¦†ç›–ç‡æ–‡ä»¶: $($coverageFiles.Count)" -ForegroundColor Yellow
          foreach ($file in $coverageFiles) {
            Write-Host "å¤„ç†æ–‡ä»¶: $($file.FullName)" -ForegroundColor Cyan
            
            $coverageContent = Get-Content $file.FullName -Raw
            if ($coverageContent -match 'line-rate="([0-9.]+)"') {
              $coveragePercent = [math]::Round([double]$Matches[1] * 100, 2)
              Write-Host "ä»£ç è¦†ç›–ç‡: $coveragePercent%" -ForegroundColor Green
              
              if ($coveragePercent -lt ${{ env.COVERAGE_THRESHOLD }}) {
                Write-Host "è­¦å‘Š: ä»£ç è¦†ç›–ç‡ä½äºé˜ˆå€¼ ${{ env.COVERAGE_THRESHOLD }}%" -ForegroundColor Red
              }
            }
          }
        } else {
          Write-Host "è­¦å‘Š: æœªæ‰¾åˆ°è¦†ç›–ç‡æ–‡ä»¶" -ForegroundColor Yellow
        }

    - name: è¿è¡Œé›†æˆæµ‹è¯•
      shell: pwsh
      run: |
        Write-Host "å¼€å§‹é›†æˆæµ‹è¯•..." -ForegroundColor Green
        
        $env:ZWCAD_SIMULATION = "true"
        
        dotnet test ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj `
          --configuration ${{ matrix.configuration }} `
          --framework ${{ env.DOTNET_FRAMEWORK_VERSION }} `
          --no-build `
          --verbosity detailed `
          --filter "Category=Integration" `
          --logger "trx;LogFileName=integration-results.trx" `
          --results-directory TestResults

    - name: è¿è¡Œæ€§èƒ½æµ‹è¯•
      shell: pwsh
      continue-on-error: true
      run: |
        Write-Host "å¼€å§‹æ€§èƒ½æµ‹è¯•..." -ForegroundColor Green
        
        $env:PERFORMANCE_TEST_MODE = "true"
        
        dotnet test ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj `
          --configuration ${{ matrix.configuration }} `
          --framework ${{ env.DOTNET_FRAMEWORK_VERSION }} `
          --no-build `
          --verbosity normal `
          --filter "Category=Performance" `
          --logger "trx;LogFileName=performance-results.trx" `
          --results-directory TestResults

    - name: ä¸Šä¼ æµ‹è¯•ç»“æœ
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results-windows-${{ matrix.configuration }}
        path: |
          TestResults/
          bin/${{ matrix.configuration }}/net48/
        retention-days: 30

    - name: å‘å¸ƒæµ‹è¯•ç»“æœ
      uses: dorny/test-reporter@v1
      if: always()
      with:
        name: æµ‹è¯•æŠ¥å‘Š - Windows ${{ matrix.configuration }}
        path: TestResults/*.trx
        reporter: dotnet-trx

  # UIæµ‹è¯•
  test-ui:
    name: UIè‡ªåŠ¨åŒ–æµ‹è¯•
    runs-on: windows-latest
    needs: test-windows
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½® .NET Framework
      uses: microsoft/setup-msbuild@v1.3
      with:
        msbuild-version: 'latest'

    - name: è®¾ç½® .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: è¿˜åŸNuGetåŒ…
      shell: pwsh
      run: |
        dotnet restore ${{ env.SOLUTION_NAME }}
        dotnet restore ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj

    - name: æ„å»ºé¡¹ç›®
      shell: pwsh
      run: |
        msbuild ${{ env.SOLUTION_NAME }} /p:Configuration=Release /p:Platform="Any CPU" /v:minimal

    - name: è¿è¡ŒUIæµ‹è¯• (æ¨¡æ‹Ÿæ¨¡å¼)
      shell: pwsh
      continue-on-error: true
      run: |
        Write-Host "å¼€å§‹UIè‡ªåŠ¨åŒ–æµ‹è¯•..." -ForegroundColor Green
        
        New-Item -ItemType Directory -Path "UITestResults" -Force
        
        $env:ZWCAD_AUTOMATION = "true"
        $env:HEADLESS_MODE = "true"
        
        dotnet test ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj `
          --configuration Release `
          --framework ${{ env.DOTNET_FRAMEWORK_VERSION }} `
          --no-build `
          --verbosity normal `
          --filter "Category=UI" `
          --logger "trx;LogFileName=ui-results.trx" `
          --results-directory UITestResults

    - name: ä¸Šä¼ UIæµ‹è¯•ç»“æœ
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ui-test-results
        path: |
          UITestResults/
        retention-days: 30

  # å®‰å…¨æ‰«æ
  security-scan:
    name: å®‰å…¨æ‰«æ
    runs-on: ubuntu-latest
    needs: code-quality
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½® .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: è¿è¡ŒCodeQLåˆ†æ
      uses: github/codeql-action/init@v3
      with:
        languages: csharp

    - name: è‡ªä¸»æ„å»ºï¼ˆä»…æµ‹è¯•é¡¹ç›®ï¼‰
      run: |
        # åªæ„å»ºæµ‹è¯•é¡¹ç›®
        dotnet restore ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj
        dotnet build ${{ env.TEST_PROJECT_NAME }}/${{ env.TEST_PROJECT_NAME }}.csproj --no-restore

    - name: æ‰§è¡ŒCodeQLåˆ†æ
      uses: github/codeql-action/analyze@v3

    - name: å®‰å…¨æ£€æŸ¥æ€»ç»“
      run: |
        echo "=== å®‰å…¨æ£€æŸ¥å®Œæˆ ==="
        echo "CodeQL ä»£ç å®‰å…¨åˆ†æå·²æ‰§è¡Œ"
        echo "ç”±äºæ˜¯.NET Frameworké¡¹ç›®ï¼Œå®Œæ•´çš„åŒ…å®‰å…¨æ‰«æéœ€è¦åœ¨Windowsä¸Šè¿›è¡Œ"

  # è®¸å¯è¯æ£€æŸ¥
  license-check:
    name: è®¸å¯è¯æ£€æŸ¥
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½® .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: è®¸å¯è¯æ‰«æ
      run: |
        echo "=== è®¸å¯è¯æ£€æŸ¥ ==="
        echo "é¡¹ç›®: ä¸­æœ›CADåŠ¨æ€å—æŸ¥å¯»æ’ä»¶"
        echo ""
        echo "ä¸»è¦è®¸å¯è¯ç±»å‹æ£€æŸ¥:"
        echo "1. âœ… MITè®¸å¯è¯ - å…è®¸å•†ä¸šä½¿ç”¨"
        echo "2. âœ… Apache 2.0è®¸å¯è¯ - å…è®¸å•†ä¸šä½¿ç”¨"
        echo "3. âœ… BSDè®¸å¯è¯ - å…è®¸å•†ä¸šä½¿ç”¨"
        echo "4. âš ï¸ GPLè®¸å¯è¯ - éœ€è¦è°¨æ…ä½¿ç”¨"
        echo ""
        echo "å»ºè®®: æ£€æŸ¥é¡¹ç›®ä½¿ç”¨çš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åº“çš„è®¸å¯è¯"
        echo "å¯ä»¥åœ¨Windowsç¯å¢ƒä¸­è¿è¡Œ 'dotnet list package --include-transitive' æŸ¥çœ‹å®Œæ•´åˆ—è¡¨"

  # å‘å¸ƒå‡†å¤‡
  prepare-release:
    name: å‘å¸ƒå‡†å¤‡
    runs-on: windows-latest
    needs: [test-windows, test-ui, security-scan, license-check]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: è®¾ç½® .NET Framework
      uses: microsoft/setup-msbuild@v1.3
      with:
        msbuild-version: 'latest'

    - name: è®¾ç½® .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ç”Ÿæˆç‰ˆæœ¬å·
      id: version
      shell: pwsh
      run: |
        $version = "v1.0.0-${{ github.run_number }}"
        Write-Output "version=$version" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        Write-Host "Generated version: $version"

    - name: æ„å»ºå‘å¸ƒç‰ˆæœ¬
      shell: pwsh
      run: |
        msbuild ${{ env.SOLUTION_NAME }} /p:Configuration=Release /p:Platform="Any CPU" /v:minimal

    - name: åˆ›å»ºå‘å¸ƒåŒ…
      shell: pwsh
      run: |
        # åˆ›å»ºå‘å¸ƒç›®å½•
        New-Item -ItemType Directory -Path "release" -Force
        
        # å¤åˆ¶æ’ä»¶æ–‡ä»¶
        if (Test-Path "bin\Release\net48\ZWDynLookup.dll") {
          Copy-Item -Path "bin\Release\net48\ZWDynLookup.dll" -Destination "release\" -Force
          Copy-Item -Path "bin\Release\net48\ZWDynLookup.pdb" -Destination "release\" -Force
          Write-Host "âœ… å·²å¤åˆ¶æ’ä»¶ä¸»æ–‡ä»¶" -ForegroundColor Green
        } else {
          Write-Host "âŒ é”™è¯¯: æœªæ‰¾åˆ°ZWDynLookup.dll" -ForegroundColor Red
          exit 1
        }
        
        # å¤åˆ¶é…ç½®æ–‡ä»¶
        if (Test-Path "ZWDynLookup.config") {
          Copy-Item -Path "ZWDynLookup.config" -Destination "release\" -Force
          Write-Host "âœ… å·²å¤åˆ¶é…ç½®æ–‡ä»¶" -ForegroundColor Green
        }
        
        # å¤åˆ¶æ–‡æ¡£
        if (Test-Path "README.md") {
          Copy-Item -Path "README.md" -Destination "release\" -Force
          Write-Host "âœ… å·²å¤åˆ¶READMEæ–‡æ¡£" -ForegroundColor Green
        }
        
        if (Test-Path "docs") {
          Copy-Item -Path "docs" -Destination "release\" -Recurse -Force
          Write-Host "âœ… å·²å¤åˆ¶æ–‡æ¡£ç›®å½•" -ForegroundColor Green
        }
        
        # åˆ›å»ºç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶
        $version = "${{ steps.version.outputs.version }}"
        $buildDate = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $versionInfo = @"
ä¸­æœ›CADåŠ¨æ€å—æŸ¥å¯»æ’ä»¶ - ç‰ˆæœ¬ä¿¡æ¯
ç‰ˆæœ¬: $version
æ„å»ºæ—¥æœŸ: $buildDate
æ„å»ºç¯å¢ƒ: GitHub Actions
.NET Framework: 4.8
"@
        $versionInfo | Out-File -FilePath "release\ç‰ˆæœ¬ä¿¡æ¯.txt" -Encoding UTF8
        
        # æ‰“åŒ…
        Compress-Archive -Path "release\*" -DestinationPath "ZWDynLookup-$version.zip" -Force
        Write-Host "âœ… å·²åˆ›å»ºå‘å¸ƒåŒ…: ZWDynLookup-$version.zip" -ForegroundColor Green

    - name: ä¸Šä¼ å‘å¸ƒåŒ…
      uses: actions/upload-artifact@v4
      with:
        name: release-package-${{ steps.version.outputs.version }}
        path: ZWDynLookup-${{ steps.version.outputs.version }}.zip
        retention-days: 90

    - name: åˆ›å»ºGitHubå‘å¸ƒ
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.version.outputs.version }}
        name: ä¸­æœ›CADåŠ¨æ€å—æŸ¥å¯»æ’ä»¶ ${{ steps.version.outputs.version }}
        body: |
          ## ğŸ¯ ä¸­æœ›CADåŠ¨æ€å—æŸ¥å¯»æ’ä»¶ ${{ steps.version.outputs.version }}
          
          ### ğŸ“‹ åŠŸèƒ½ç‰¹æ€§
          - åŠ¨æ€å—å‚æ•°æŸ¥è¯¢
          - æ‰¹é‡å‚æ•°å¤„ç†
          - æ”¯æŒä¸­æœ›CAD 2024+
          
          ### ğŸ“¦ åŒ…å«æ–‡ä»¶
          - ZWDynLookup.dll - æ’ä»¶ä¸»ç¨‹åº
          - ZWDynLookup.pdb - è°ƒè¯•ç¬¦å·æ–‡ä»¶
          - ç‰ˆæœ¬ä¿¡æ¯.txt - ç‰ˆæœ¬è¯¦æƒ…
          - README.md - ä½¿ç”¨è¯´æ˜
          
          ### ğŸ”§ å®‰è£…è¯´æ˜
          1. å°† ZWDynLookup.dll å¤åˆ¶åˆ°ä¸­æœ›CADæ’ä»¶ç›®å½•
          2. åœ¨ä¸­æœ›CADä¸­è¿è¡Œ NETLOAD å‘½ä»¤åŠ è½½æ’ä»¶
          3. ä½¿ç”¨ BPARAMETER å’Œ BACTIONTOOL å‘½ä»¤è¿›è¡Œæ“ä½œ
          
          ### ğŸ“ æŠ€æœ¯æ”¯æŒ
          æŸ¥çœ‹ README.md è·å–è¯¦ç»†ä½¿ç”¨è¯´æ˜
        files: |
          ZWDynLookup-${{ steps.version.outputs.version }}.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # é€šçŸ¥å’ŒæŠ¥å‘Š
  notify-results:
    name: é€šçŸ¥æµ‹è¯•ç»“æœ
    runs-on: ubuntu-latest
    needs: [test-windows, test-ui, security-scan, license-check]
    if: always()
    
    steps:
    - name: ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šæ‘˜è¦
      run: |
        echo "## ğŸ“Š ä¸­æœ›CADåŠ¨æ€å—æŸ¥å¯»æ’ä»¶ - æµ‹è¯•æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ·ï¸ æµ‹è¯•ç¯å¢ƒä¿¡æ¯" >> $GITHUB_STEP_SUMMARY
        echo "- **æ„å»ºç³»ç»Ÿ**: GitHub Actions" >> $GITHUB_STEP_SUMMARY
        echo "- **.NET Framework**: 4.8" >> $GITHUB_STEP_SUMMARY
        echo "- **è§¦å‘åˆ†æ”¯**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **è§¦å‘äº‹ä»¶**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### âœ… æµ‹è¯•ä»»åŠ¡çŠ¶æ€" >> $GITHUB_STEP_SUMMARY
        echo "| æµ‹è¯•ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |" >> $GITHUB_STEP_SUMMARY
        echo "|---------|------|------|" >> $GITHUB_STEP_SUMMARY
        echo "| ä»£ç è´¨é‡æ£€æŸ¥ | ${{ needs.code-quality.result }} | æ„å»ºå’ŒåŸºæœ¬æµ‹è¯• |" >> $GITHUB_STEP_SUMMARY
        echo "| Windowsç¯å¢ƒæµ‹è¯• | ${{ needs.test-windows.result }} | å•å…ƒ/é›†æˆ/æ€§èƒ½æµ‹è¯• |" >> $GITHUB_STEP_SUMMARY
        echo "| UIè‡ªåŠ¨åŒ–æµ‹è¯• | ${{ needs.test-ui.result }} | ç”¨æˆ·ç•Œé¢æµ‹è¯• |" >> $GITHUB_STEP_SUMMARY
        echo "| å®‰å…¨æ‰«æ | ${{ needs.security-scan.result }} | CodeQLå®‰å…¨åˆ†æ |" >> $GITHUB_STEP_SUMMARY
        echo "| è®¸å¯è¯æ£€æŸ¥ | ${{ needs.license-check.result }} | è®¸å¯è¯åˆè§„æ€§ |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # æ€»ä½“çŠ¶æ€
        if [[ "${{ needs.code-quality.result }}" == "success" && "${{ needs.test-windows.result }}" == "success" ]]; then
          echo "### ğŸ‰ æµ‹è¯•ç»“æœ: âœ… é€šè¿‡" >> $GITHUB_STEP_SUMMARY
          echo "æ ¸å¿ƒæµ‹è¯•å·²é€šè¿‡ï¼Œæ’ä»¶å¯ä»¥æ­£å¸¸æ„å»ºå’Œä½¿ç”¨ï¼" >> $GITHUB_STEP_SUMMARY
        else
          echo "### âš ï¸ æµ‹è¯•ç»“æœ: âŒ å¤±è´¥" >> $GITHUB_STEP_SUMMARY
          echo "éƒ¨åˆ†æµ‹è¯•æœªé€šè¿‡ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ä¿®å¤é—®é¢˜ã€‚" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“ˆ åç»­æ­¥éª¤" >> $GITHUB_STEP_SUMMARY
        if [[ "${{ github.ref_name }}" == "main" && "${{ needs.prepare-release.result }}" == "success" ]]; then
          echo "- âœ… å‘å¸ƒç‰ˆæœ¬å·²åˆ›å»º" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“¦ å‘å¸ƒåŒ…å¯åœ¨ Artifacts ä¸­ä¸‹è½½" >> $GITHUB_STEP_SUMMARY
        elif [[ "${{ github.ref_name }}" == "main" && "${{ needs.prepare-release.result }}" != "success" ]]; then
          echo "- âš ï¸ å‘å¸ƒå‡†å¤‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—" >> $GITHUB_STEP_SUMMARY
        else
          echo "- ğŸ”„ é main åˆ†æ”¯ï¼Œè·³è¿‡å‘å¸ƒ" >> $GITHUB_STEP_SUMMARY
        fi

    - name: å‘é€é€šçŸ¥
      if: always()
      run: |
        if [[ "${{ needs.code-quality.result }}" == "success" && "${{ needs.test-windows.result }}" == "success" ]]; then
          echo "ğŸ‰ æ ¸å¿ƒæµ‹è¯•é€šè¿‡ï¼"
          echo "æ’ä»¶å¯ä»¥æ­£å¸¸æ„å»ºå’Œæµ‹è¯•ã€‚"
        else
          echo "âš ï¸ æµ‹è¯•å¤±è´¥ï¼"
          echo "è¯·æ£€æŸ¥å¤±è´¥çš„æµ‹è¯•ä»»åŠ¡å¹¶ä¿®å¤ç›¸å…³é—®é¢˜ã€‚"
        fi