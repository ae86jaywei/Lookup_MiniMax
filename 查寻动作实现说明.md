---
AIGC:
    ContentProducer: Minimax Agent AI
    ContentPropagator: Minimax Agent AI
    Label: AIGC
    ProduceID: "00000000000000000000000000000000"
    PropagateID: "00000000000000000000000000000000"
    ReservedCode1: 3045022100977df2187bdecfab171bc561508edeeace43d5e6687e427c07989f1c870c031e02206717e27018120e36f6fc89f353641702bb1cbafab3724de4f1a2a32d2956cc88
    ReservedCode2: 304402200997b0deeb07f094646f836b8c05ae4dc243c1cb12b76f18f3ad132a8d098f4802206c38fc7f7e81f31c8319640a4657473024a243e8b1b91f358211dfb9824beeb0
---

# BACTIONTOOL命令查寻动作选项实现说明

## 概述
已成功创建了BACTIONTOOL命令的查寻动作选项完整实现，包括命令主类、动作创建器、选择管理器和选择集管理等功能模块。

## 创建的文件

### 1. BActionToolCommand.cs (已更新)
**位置**: `code/ZWDynLookup/Commands/BActionToolCommand.cs`

**新增功能**:
- 添加了L选项（查寻动作）的完整实现
- 支持命令选项选择：查寻动作(L)、标准动作(S)、管理选择集(M)
- 查寻动作创建流程
- 查寻值输入对话框
- 预设值选择功能
- 与动作创建器、选择管理器的集成

**主要方法**:
- `Execute()` - 主执行方法，支持选项选择
- `ExecuteLookupActionFlow()` - 查寻动作创建流程
- `SetupLookupValues()` - 设置查寻值
- `ShowCommandOptions()` - 显示命令选项

### 2. LookupActionCreator.cs (新建)
**位置**: `code/ZWDynLookup/Commands/LookupActionCreator.cs`

**功能**:
- 查寻动作的完整创建和管理
- 动作图标、标签和连接线的创建
- 查寻值的存储和管理
- 选择集关联
- 动作触发和执行
- 查寻表关联

**主要方法**:
- `CreateLookupAction()` - 创建查寻动作
- `TriggerLookupAction()` - 触发查寻动作
- `SetActionProperties()` - 设置动作属性
- `AssociateSelectionSet()` - 关联选择集

### 3. ActionSelectionManager.cs (新建)
**位置**: `code/ZWDynLookup/Commands/ActionSelectionManager.cs`

**功能**:
- 参数和实体的选择管理
- 支持多种选择模式：窗口、交叉、上一个选择集
- 选择验证和统计
- 选择高亮显示
- 选择集中心点计算

**主要方法**:
- `StartParameterSelection()` - 开始参数选择
- `StartEntitySelection()` - 开始实体选择
- `ValidateSelection()` - 验证选择有效性
- `HighlightSelection()` - 高亮显示选择

### 4. SelectionSetManager.cs (新建)
**位置**: `code/ZWDynLookup/Commands/SelectionSetManager.cs`

**功能**:
- 命名选择集的创建和管理
- 选择集的重命名、删除操作
- 选择集统计信息
- 选择集管理对话框
- 当前选择集的维护

**主要方法**:
- `CreateSelectionSet()` - 创建选择集
- `ManageSelectionSets()` - 管理选择集
- `GetSelectionSetStatistics()` - 获取统计信息

### 5. ActionPropertiesDialog.cs (已更新)
**位置**: `code/ZWDynLookup/UI/ActionPropertiesDialog.cs`

**新增功能**:
- 支持查寻动作属性设置
- 默认值下拉框
- 查寻值列表显示和编辑
- 动作启用/禁用选项
- 标签显示控制
- 查寻值编辑对话框

**新增属性**:
- `DefaultValue` - 默认值
- `LookupValues` - 查寻值列表
- `SelectedObjects` - 选中对象数量
- `EnableAction` - 是否启用动作
- `ShowLabel` - 是否显示标签

## 主要特性

### 1. 查寻动作创建流程
```
1. 选择命令选项 (查寻动作L/标准动作S/管理选择集M)
2. 选择查寻参数
3. 选择受动作影响的对象
4. 设置查寻值
5. 配置动作属性
6. 创建查寻动作
```

### 2. 查寻值管理
- 支持手动输入查寻值
- 提供预设值模板
- 查寻值验证和去重
- 默认值设置

### 3. 选择集管理
- 命名选择集的创建和管理
- 选择集的统计信息
- 选择集的持久化存储
- 选择集操作（重命名、删除等）

### 4. 动作触发机制
- 动作图标和标签的创建
- 参数与动作的关联
- 选择集与动作的关联
- 动作执行逻辑

### 5. 用户界面
- 直观的选择界面
- 详细的属性设置对话框
- 查寻值编辑功能
- 预设值选择

## 集成说明

### 与现有系统的集成
- 所有新文件都位于现有的`Commands`和`UI`目录结构中
- 使用现有的插件架构和日志系统
- 遵循现有的代码规范和设计模式

### 依赖关系
- `BActionToolCommand` 依赖 `ActionSelectionManager`、`SelectionSetManager`、`LookupActionCreator`
- `ActionPropertiesDialog` 提供用户界面支持
- 所有组件都依赖中望CAD的API

### 扩展性
- 模块化设计，易于扩展
- 支持新的选择模式
- 支持新的查寻值类型
- 支持自定义动作类型

## 使用方法

1. 在中望CAD块编辑器中执行 `ZWBACTIONTOOL` 命令
2. 选择 "查寻动作(L)" 选项
3. 按照提示选择查寻参数
4. 选择受动作影响的对象
5. 设置查寻值和动作属性
6. 完成查寻动作创建

## 技术特点

- 完整的查寻动作生命周期管理
- 灵活的查寻值配置机制
- 高效的选择集管理
- 友好的用户界面
- 完善的错误处理和日志记录
- 支持中文界面和提示信息

该实现完全满足了BACTIONTOOL命令L选项（查寻动作）的功能需求，提供了完整的查寻动作创建、管理和执行功能。